---
title: 宿主机时间同步
date: 2020-11-13 16:43:23
categories: Docker
tags: Docker
---

Windows环境下部署docker设置docker时间和宿主机保持一致（以部署mssql为例）
1.运行mssql容器，指定参数 <-e TZ=Asia/Shanghai>
docker run -e "ACCEPT_EULA=Y" -e "SA_PASSWORD=Test1234" -p 1444:1433 --name sqlserver -e TZ=Asia/Shanghai -v /E/SqlServer:/var/opt/mssql/data -d mcr.microsoft.com/mssql/server:2017-latest
2.进入容器
docker exec -it xxxxxxx /bin/bash
3.获得当前时间会发现，所得时间为世界标准时间（utc）与宿主机本地不一致，以北京时间为准，相差八个时区即8小时
date
4.docker依赖于linux环境，linux更改时区信息一般都位于 /etc/localtime 目录下，这个时候开始一下步骤：
1)查看当前的系统是什么
cat /etc/issue
2)下载或执行更新，如果无法找到源文件或者没法通过vim直接创建source.list，可以在宿主机本地新建source.list然后copy到docker里面去
ubuntu16 apt-get更新为阿里源
<本地新建source.list文件内容如下>
deb-src http://archive.ubuntu.com/ubuntu xenial main restricted #Added by software-properties
deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted
deb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted multiverse universe #Added by software-properties
deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted multiverse universe #Added by software-properties
deb http://mirrors.aliyun.com/ubuntu/ xenial universe
deb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe
deb http://mirrors.aliyun.com/ubuntu/ xenial multiverse
deb http://mirrors.aliyun.com/ubuntu/ xenial-updates multiverse
deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse #Added by software-properties
deb http://archive.canonical.com/ubuntu xenial partner
deb-src http://archive.canonical.com/ubuntu xenial partner
deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted multiverse universe #Added by software-properties
deb http://mirrors.aliyun.com/ubuntu/ xenial-security universe
deb http://mirrors.aliyun.com/ubuntu/ xenial-security multiverse
3)移动到docker下
exit
docker cp xxxx containerid:/etc/apt/source.list
docker exec -it containerid /bin/bash
4)执行更新命令，需要等待一会儿
apt-get update
5.更新完成之后，下载tzdate/tzdata
apt install tzdata（阿里源） 或者 apt install tzdate
6.现在不出意外的话时区映射的路径 /usr/share/zoneinfo/ 应该已经可以访问
7.执行命令，更改时区，选择为本地时区即可
tzselect
8.将容器中下载的时区包拷贝到本地文件夹中
docker cp containerid:/usr/share/zoneinfo/ D:\Docker
9.创建新容器的时候添加该映射即可，这样创建之后再次进入容器查询date就会发现时区是本地定义的时区了。
-v /D/Docker:/usr/share/zoneinfo/

10.更改本地时间同步到docker时，需要重启docker